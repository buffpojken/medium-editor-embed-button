!function(e,t,n){"use strict";function i(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function s(e,t,n){function i(t,n){return r.set(e,t,n),a}function s(t){return r.del(e,t),a}function o(t){return r.get(e,t)}var a={set:i,get:o,del:s};return 3===arguments.length?i(t,n):2==arguments.length?o(t):a}var r;if(r=void 0!==t&&t.head&&t.head.dataset?{set:function(e,t,n){e.dataset[t]=n},get:function(e,t){return e.dataset[t]},del:function(e,t){delete e.dataset[t]}}:{set:function(e,t,n){e.setAttribute("data-"+i(t),n)},get:function(e,t){return e.getAttribute("data-"+i(t))},del:function(e,t){e.removeAttribute("data-"+i(t))}},"function"!=typeof n)throw new Error("Medium Editor is not loaded on the page.");var o={name:"embedButton",action:"embedAction",contentDefault:"E",contentFA:'<i class="fa fa-youtube-play"></i>',aria:"Embed media",defaults:{onEmbedError:function(){},msgSelectOnlyUrl:"Seçtiğiniz metin geçerli bir URL değil!",msgSelectOnlyEmbadableUrl:"Seçtiğiniz URL desteklenmiyor!",oembedProxy:"http://iframe.ly/api/oembed?api_key=APIKEY_HERE&url=",cssEmbedOverlay:"medium-editor-embeds-overlay",cssEmbeds:"medium-editor-embeds",cssSelected:"medium-editor-embeds-selected",instagramEmbedScript:"//platform.instagram.com/en_US/embeds.js",twitterEmbedScripts:"//platform.twitter.com/widgets.js",facebookEmbedScripts:"//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7",ifrmelyEmbedScript:"//cdn.iframe.ly/embed.js",vimeoEmbedScripts:""},init:function(){n.extensions.button.prototype.init.call(this),this.opts=n.util.extend({},this.defaults,this.embedOpts);var e=this,t=e.document,i=t.querySelectorAll("."+e.opts.cssEmbeds);if(this.base._originalSerializerPreEmbeds=e.base.serialize,this.base.serialize=e.embedSerialize,this.attachEvents(),void 0!==i&&null!==i&&0!==i.length)for(var s=0;s<i.length;s++){var r=i[s];r.setAttribute("contenteditable",!1),null===r.querySelector("."+e.opts.cssEmbedOverlay)&&e.appendOverlay(r)}},attachEvents:function(){this.on(this.document,"click",this.unselectEmbed.bind(this));var e=this.document.querySelectorAll("."+this.opts.cssEmbedOverlay);this.on(e,"click",this.selectEmbed.bind(this)),this.on(this.document,"keydown",this.removeEmbed.bind(this)),this.on(this.base.elements,"keydown",this.deleteEmbedOnBackspaceAndDel.bind(this))},ajaxGet:function(e,n,i){var s=new XMLHttpRequest;return s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?n.apply(s,[JSON.parse(s.responseText)]):400===s.status||void 0!==i&&i.apply(s))},s.open("GET",e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Access-Control-Allow-Origin","*"),s.setRequestHeader("Referrer",t.location.href),s.send(),s},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this,i=n.selection.getSelectionRange(t.document);if("a"===i.startContainer.nodeName.toLowerCase()||"a"===i.endContainer.nodeName.toLowerCase()||n.util.getClosestTag(n.selection.getSelectedParentElement(i),"a"))return t.execAction("unlink");if("#text"!==i.startContainer.nodeName.toLowerCase()&&"#text"!==i.endContainer.nodeName.toLowerCase())return alert(t.opts.msgSelectOnlyUrl),!1;var s=this.getSelection();if(s.indexOf("http")<0)return alert(t.opts.msgSelectOnlyUrl),!1;t.ajaxGet(t.opts.oembedProxy+s,function(e){"OEMBED_MISSING"==e.result||"OEMBED_UNKNOWN_ERROR"==e.result?t.opts.onEmbedError(e):(i.deleteContents(),t.insertEmbed(e))}),t.base.checkContentChanged()},getSelection:function(){var n="";return e.getSelection?n=e.getSelection().toString():t.getSelection?n=t.getSelection().toString():t.selection&&(n=t.selection.createRange().text),n},appendOverlay:function(e){var t=this.document.createElement("div");t.className=this.opts.cssEmbedOverlay,e.appendChild(t)},insertEmbed:function(e){var t=this,i=n.util.guid(),r=t.document.createElement("div");r.setAttribute("id",i),r.setAttribute("contenteditable",!1),s(r,"originalResponse",JSON.stringify(e)),r.className=t.opts.cssEmbeds,r.innerHTML=e.html,t.appendOverlay(r),t.base.pasteHTML(t.getHtml(r),{cleanAttrs:[],cleanTags:[]});var o=t.document.getElementById(i).querySelector("."+t.opts.cssEmbedOverlay);this.on(o,"click",this.selectEmbed.bind(this)),t.parseSiteSpecific(e)},loadIfIframely:function(){void 0!==this.opts.oembedProxy&&this.opts.oembedProxy.indexOf("iframely")&&this.injectScript(this.opts.ifrmelyEmbedScript)},parseSiteSpecific:function(t){var n=this;if(t.url.indexOf("instagr")>-1){if(void 0===e.instgrm)return void n.injectScript(n.opts.instagramEmbedScript);e.instgrm.Embeds.process()}else if(t.url.indexOf("facebook")>-1)void 0===e.FB&&n.injectScript(n.opts.facebookEmbedScripts),setTimeout(function(){e.FB.XFBML.parse()},1e3);else if(t.url.indexOf("twitter")>-1){if(void 0===e.twttr)return void n.injectScript(n.opts.twitterEmbedScripts);e.twttr.widgets.load()}else n.loadIfIframely()},selectEmbed:function(e){e.preventDefault(),e.stopPropagation();var t=this,n=e.target,i=n.parentElement;if(!i.classList.contains(t.opts.cssSelected)){var s=t.document.querySelectorAll("."+t.opts.cssEmbeds);void 0!==s&&null!==s&&s.forEach(function(e){e.classList.remove(t.opts.cssSelected)}),i.classList.add(t.opts.cssSelected)}},unselectEmbed:function(e){var t=this,n=e.target,i=t.document.querySelectorAll("."+t.opts.cssEmbeds);if(void 0!==i&&null!==i&&0!==i.length&&!n.classList.contains(t.opts.cssEmbedOverlay))for(var s=0;s<i.length;s++){var r=i[s];r.classList.remove(t.opts.cssSelected)}},removeEmbed:function(e){var t,i=this;if(n.util.isKey(e,[n.util.keyCode.BACKSPACE,n.util.keyCode.DELETE])&&null!==(t=i.document.querySelector("."+i.opts.cssSelected))){e.preventDefault();var s=i.document.createElement("p");t.parentElement.insertBefore(s,t),t.parentElement.removeChild(t)}},deleteEmbedOnBackspaceAndDel:function(e){if(n.util.isKey(e,[n.util.keyCode.DELETE,n.util.keyCode.BACKSPACE])){var t=n.selection.getSelectionStart(this.base.options.ownerDocument),i=this,s=n.selection.getSelectionRange(i.document),r=n.util.getClosestTag(n.selection.getSelectedParentElement(s),"p");if(!(n.selection.getCaretOffsets(t).left>0)){var o=r.previousSibling;if(void 0!==o&&void 0!==o.classList&&o.classList.contains(i.opts.cssEmbeds)){e.preventDefault(),e.stopPropagation();var a=i.document.createElement("p");o.parentElement.insertBefore(a,o),o.parentElement.removeChild(o)}}}},embedSerialize:function(){var e=this,t=e._originalSerializerPreEmbeds(),n=e.options.ownerDocument,i=e.getExtensionByName("embedButton");for(var r in t)if(t.hasOwnProperty(r)){var o=t[r],a=n.createElement("div");a.innerHTML=o.value;var l=a.querySelectorAll("."+i.opts.cssEmbeds);if(void 0!==l&&null!==l&&l.length>0)for(var c=0;c<l.length;c++){var d=l[c],m=s(d,"originalResponse");if(m&&null!==m){var u=JSON.parse(m);d.innerHTML=u.html;var p={html:u.html,url:u.url};s(d).set("originalResponse",JSON.stringify(p))}else{var f=d.querySelector("."+i.opts.cssEmbedOverlay);null!==f&&f.parentElement.removeChild(f)}d.removeAttribute("contenteditable"),d.classList.remove(i.opts.cssSelected)}t[r].value=a.innerHTML}return t},getHtml:function(e){var t=this.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},injectScript:function(e){var t=this.document.createElement("script");t.type="text/javascript",t.async=!0,t.onLoad=function(){},t.src=this.document.location.protocol+e,this.document.getElementsByTagName("head")[0].appendChild(t)}};e.EmbedButtonExtension=n.extensions.button.extend(o)}(window,document,MediumEditor);
//# sourceMappingURL=medium-editor-embed-button.js.map
