{"version":3,"sources":["medium-editor-embed-button.js"],"names":["window","document","MediumEditor","toDashed","name","replace","u","toLowerCase","dataset","node","attr","value","set","fn","self","del","get","arguments","length","head","setAttribute","getAttribute","removeAttribute","Error","embedButton","action","contentDefault","contentFA","aria","defaults","onEmbedError","msgSelectOnlyUrl","msgSelectOnlyEmbadableUrl","oembedProxy","cssEmbedOverlay","cssEmbeds","cssSelected","instagramEmbedScript","twitterEmbedScripts","facebookEmbedScripts","ifrmelyEmbedScript","vimeoEmbedScripts","init","extensions","button","prototype","call","this","opts","util","extend","embedOpts","doc","$embeds","querySelectorAll","base","_originalSerializerPreEmbeds","serialize","embedSerialize","attachEvents","i","$elem","querySelector","appendOverlay","on","unselectEmbed","bind","$allEmbeds","selectEmbed","removeEmbed","elements","deleteEmbedOnBackspaceAndDel","ajaxGet","url","callback","failCallback","xmlhttp","XMLHttpRequest","onreadystatechange","readyState","DONE","status","apply","JSON","parse","responseText","open","setRequestHeader","location","href","send","handleClick","e","preventDefault","stopPropagation","range","selection","getSelectionRange","startContainer","nodeName","endContainer","getClosestTag","getSelectedParentElement","execAction","alert","selectedText","getSelection","indexOf","data","result","deleteContents","insertEmbed","checkContentChanged","txt","toString","createRange","text","$overlay","createElement","className","appendChild","id","guid","$wrapper","stringify","innerHTML","html","pasteHTML","getHtml","cleanAttrs","cleanTags","getElementById","parseSiteSpecific","loadIfIframely","injectScript","instgrm","Embeds","process","setTimeout","FB","XFBML","twttr","widgets","load","$target","target","$parent","parentElement","classList","contains","$alreadySelected","forEach","elem","remove","add","$embed","isKey","keyCode","BACKSPACE","DELETE","p","insertBefore","removeChild","$current","getSelectionStart","options","ownerDocument","getCaretOffsets","left","$isEmbed","previousSibling","newP","embedExtension","getExtensionByName","key","hasOwnProperty","obj","$data","responseData","originalData","simpleData","$wrap","cloneNode","script","type","async","onLoad","src","protocol","getElementsByTagName","EmbedButtonExtension"],"mappings":"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","file":"medium-editor-embed-button.js","sourcesContent":["/**\n * Created by orhanveli on 15/08/16.\n */\n\n(function (window, document, MediumEditor) {\n    \"use strict\";\n\n\n\n// replace namesLikeThis with names-like-this\n    function toDashed(name) {\n        return name.replace(/([A-Z])/g, function(u) {\n            return \"-\" + u.toLowerCase();\n        });\n    }\n\n    var fn;\n\n    if (typeof document !== \"undefined\" && document.head && document.head.dataset) {\n        fn = {\n            set: function(node, attr, value) {\n                node.dataset[attr] = value;\n            },\n            get: function(node, attr) {\n                return node.dataset[attr];\n            },\n            del: function (node, attr) {\n                delete node.dataset[attr];\n            }\n        };\n    } else {\n        fn = {\n            set: function(node, attr, value) {\n                node.setAttribute('data-' + toDashed(attr), value);\n            },\n            get: function(node, attr) {\n                return node.getAttribute('data-' + toDashed(attr));\n            },\n            del: function (node, attr) {\n                node.removeAttribute('data-' + toDashed(attr));\n            }\n        };\n    }\n\n    function dataset(node, attr, value) {\n        var self = {\n            set: set,\n            get: get,\n            del: del\n        };\n\n        function set(attr, value) {\n            fn.set(node, attr, value);\n            return self;\n        }\n\n        function del(attr) {\n            fn.del(node, attr);\n            return self;\n        }\n\n        function get(attr) {\n            return fn.get(node, attr);\n        }\n\n        if (arguments.length === 3) {\n            return set(attr, value);\n        }\n        if (arguments.length == 2) {\n            return get(attr);\n        }\n\n        return self;\n    }\n\n\n\n    if (typeof MediumEditor !== \"function\") {\n        throw new Error(\"Medium Editor is not loaded on the page.\");\n    }\n\n    var embedButton = {\n        \"name\": \"embedButton\",\n        \"action\": \"embedAction\",\n        \"contentDefault\": \"E\",\n        \"contentFA\": '<i class=\"fa fa-youtube-play\"></i>',\n        \"aria\": \"Embed media\",\n\n        \"defaults\": {\n            \"onEmbedError\": function(){},\n            \"msgSelectOnlyUrl\": \"Seçtiğiniz metin geçerli bir URL değil!\",\n            \"msgSelectOnlyEmbadableUrl\": \"Seçtiğiniz URL desteklenmiyor!\",\n            \"oembedProxy\": \"http://iframe.ly/api/oembed?api_key=APIKEY_HERE&url=\",\n            \"cssEmbedOverlay\": \"medium-editor-embeds-overlay\",\n            \"cssEmbeds\": \"medium-editor-embeds\",\n            \"cssSelected\": \"medium-editor-embeds-selected\",\n            \"instagramEmbedScript\": \"//platform.instagram.com/en_US/embeds.js\",\n            \"twitterEmbedScripts\": \"//platform.twitter.com/widgets.js\",\n            \"facebookEmbedScripts\": \"//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7\",\n            \"ifrmelyEmbedScript\": \"//cdn.iframe.ly/embed.js\",\n            \"vimeoEmbedScripts\": \"\"\n        },\n\n        \"init\": function() {\n            MediumEditor.extensions.button.prototype.init.call(this);\n            this.opts = MediumEditor.util.extend({}, this.defaults, this.embedOpts);\n            var self = this,\n                doc = self.document,\n                $embeds = doc.querySelectorAll(\".\" + self.opts.cssEmbeds);\n\n            this.base._originalSerializerPreEmbeds = self.base.serialize;\n            this.base.serialize = self.embedSerialize;\n            this.attachEvents();\n\n            if (typeof $embeds === \"undefined\" || $embeds === null || $embeds.length === 0) {\n                return;\n            }\n\n            for (var i = 0; i < $embeds.length; i++) {\n                var $elem = $embeds[i];\n                $elem.setAttribute(\"contenteditable\", false);\n                if ($elem.querySelector(\".\" + self.opts.cssEmbedOverlay) === null) {\n                    self.appendOverlay($elem);\n                }\n            }\n\n        },\n\n        \"attachEvents\": function() {\n            this.on(this.document, \"click\", this.unselectEmbed.bind(this));\n            var $allEmbeds = this.document.querySelectorAll(\".\" + this.opts.cssEmbedOverlay);\n            this.on($allEmbeds, \"click\", this.selectEmbed.bind(this));\n            this.on(this.document, \"keydown\", this.removeEmbed.bind(this));\n            this.on(this.base.elements, \"keydown\", this.deleteEmbedOnBackspaceAndDel.bind(this));\n        },\n\n        \"ajaxGet\": function(url, callback, failCallback) {\n            var xmlhttp = new XMLHttpRequest();\n            xmlhttp.onreadystatechange = function() {\n                if (xmlhttp.readyState === XMLHttpRequest.DONE) {\n                    if (xmlhttp.status === 200) {\n                        callback.apply(xmlhttp, [JSON.parse(xmlhttp.responseText)]);\n                    } else if (xmlhttp.status === 400) {\n                        //console.log('There was an error 400');\n                    } else {\n                        //console.log('something else other than 200 was returned');\n                        if (typeof failCallback !== \"undefined\") {\n                            failCallback.apply(xmlhttp);\n                        }\n                    }\n                }\n            };\n\n            xmlhttp.open(\"GET\", url, true);\n            xmlhttp.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n            xmlhttp.setRequestHeader(\"Access-Control-Allow-Origin\", \"*\");\n            xmlhttp.setRequestHeader(\"Referrer\", document.location.href);\n            xmlhttp.send();\n            return xmlhttp;\n        },\n\n        \"handleClick\": function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var self = this;\n\n            var range = MediumEditor.selection.getSelectionRange(self.document);\n\n            if (range.startContainer.nodeName.toLowerCase() === \"a\" ||\n                range.endContainer.nodeName.toLowerCase() === \"a\" ||\n                MediumEditor.util.getClosestTag(MediumEditor.selection.getSelectedParentElement(range), \"a\")) {\n                return self.execAction(\"unlink\");\n            }\n\n            if (range.startContainer.nodeName.toLowerCase() !== \"#text\" &&\n                range.endContainer.nodeName.toLowerCase() !== \"#text\") {\n                alert(self.opts.msgSelectOnlyUrl);\n                return false;\n            }\n\n            var selectedText = this.getSelection();\n\n            if (selectedText.indexOf(\"http\") < 0) {\n                alert(self.opts.msgSelectOnlyUrl);\n                return false;\n            }\n\n            self.ajaxGet(self.opts.oembedProxy + selectedText,\n                function(data) {\n                    if(data.result == \"OEMBED_MISSING\" || data.result == \"OEMBED_UNKNOWN_ERROR\"){\n                        self.opts.onEmbedError(data);\n                    }else{\n                        range.deleteContents();\n                        self.insertEmbed(data);                        \n                    }\n                });\n\n            self.base.checkContentChanged();\n        },\n\n        \"getSelection\": function() {\n            var txt = \"\";\n            if (window.getSelection) {\n                txt = window.getSelection().toString();\n            } else if (document.getSelection) {\n                txt = document.getSelection().toString();\n            } else if (document.selection) {\n                txt = document.selection.createRange().text;\n            }\n            return txt;\n        },\n\n        \"appendOverlay\": function($elem) {\n            var $overlay = this.document.createElement(\"div\");\n            $overlay.className = this.opts.cssEmbedOverlay;\n            $elem.appendChild($overlay);\n        },\n\n        \"insertEmbed\": function(data) {\n            var self = this,\n                id = MediumEditor.util.guid(),\n                $wrapper = self.document.createElement(\"div\");\n\n            $wrapper.setAttribute(\"id\", id);\n            $wrapper.setAttribute(\"contenteditable\", false);\n\n            dataset($wrapper, \"originalResponse\", JSON.stringify(data));\n\n            $wrapper.className = self.opts.cssEmbeds;\n            $wrapper.innerHTML = data.html;\n            self.appendOverlay($wrapper);\n            self.base.pasteHTML(self.getHtml($wrapper),\n                {\n                    cleanAttrs: [],\n                    cleanTags: []\n                });\n            var $overlay = self.document.getElementById(id).querySelector(\".\" + self.opts.cssEmbedOverlay);\n            this.on($overlay, \"click\", this.selectEmbed.bind(this));\n\n            self.parseSiteSpecific(data);\n        },\n\n        \"loadIfIframely\": function() {\n            if (typeof this.opts.oembedProxy !== \"undefined\" && this.opts.oembedProxy.indexOf(\"iframely\")) {\n                this.injectScript(this.opts.ifrmelyEmbedScript);\n            }\n        },\n\n        \"parseSiteSpecific\": function (data) {\n            var self = this;\n\n            if (data.url.indexOf(\"instagr\") > -1) {\n                if (typeof (window.instgrm) === \"undefined\") {\n                    self.injectScript(self.opts.instagramEmbedScript);\n                    return;\n                }\n                window.instgrm.Embeds.process();\n            } else if (data.url.indexOf(\"facebook\") > -1) {\n                if (typeof (window.FB) === \"undefined\") {\n                    self.injectScript(self.opts.facebookEmbedScripts);\n                }\n                setTimeout(function() {\n                    window.FB.XFBML.parse();\n                }, 1000);\n            } else if (data.url.indexOf(\"twitter\") > -1) {\n                if (typeof (window.twttr) === \"undefined\") {\n                    self.injectScript(self.opts.twitterEmbedScripts);\n                    return;\n                }\n                window.twttr.widgets.load();\n            }\n            else {\n                self.loadIfIframely();\n            }\n        },\n\n        \"selectEmbed\": function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var self = this,\n                $target = e.target,\n                $parent = $target.parentElement;\n\n            if ($parent.classList.contains(self.opts.cssSelected)) {\n                return;\n            }\n\n            var $alreadySelected = self.document.querySelectorAll(\".\" + self.opts.cssEmbeds);\n            if (typeof $alreadySelected !== \"undefined\" && $alreadySelected !== null) {\n                $alreadySelected.forEach(function(elem) {\n                    elem.classList.remove(self.opts.cssSelected);\n                });\n            }\n\n            $parent.classList.add(self.opts.cssSelected);\n        },\n\n        \"unselectEmbed\": function(e) {\n            var self = this,\n                $target = e.target,\n                $embeds = self.document.querySelectorAll(\".\" + self.opts.cssEmbeds);\n\n            if (typeof $embeds === \"undefined\" || $embeds === null || $embeds.length === 0) {\n                return;\n            }\n\n            if ($target.classList.contains(self.opts.cssEmbedOverlay)) {\n                return;\n            }\n\n            //clear all selecteds\n            for (var i = 0; i < $embeds.length; i++) {\n                var $elem = $embeds[i];\n                $elem.classList.remove(self.opts.cssSelected);\n            }\n        },\n\n        \"removeEmbed\": function(e) {\n            var $embed,\n                self = this;\n\n            if (!MediumEditor.util.isKey(e, [MediumEditor.util.keyCode.BACKSPACE, MediumEditor.util.keyCode.DELETE])) {\n                return;\n            }\n\n            $embed = self.document.querySelector(\".\" + self.opts.cssSelected);\n\n            if ($embed === null) {\n                return;\n            }\n\n            e.preventDefault();\n\n            var p = self.document.createElement(\"p\");\n            $embed.parentElement.insertBefore(p, $embed);\n            $embed.parentElement.removeChild($embed);\n        },\n\n        \"deleteEmbedOnBackspaceAndDel\": function(e) {\n            if (!MediumEditor.util.isKey(e, [MediumEditor.util.keyCode.DELETE, MediumEditor.util.keyCode.BACKSPACE])) {\n                return;\n            }\n\n            var $current = MediumEditor.selection.getSelectionStart(this.base.options.ownerDocument),\n                self = this,\n                range = MediumEditor.selection.getSelectionRange(self.document),\n                p = MediumEditor.util.getClosestTag(MediumEditor.selection.getSelectedParentElement(range), \"p\"),\n                caretOffsets = MediumEditor.selection.getCaretOffsets($current);\n\n            if (caretOffsets.left > 0) {\n                return;\n            }\n\n            var $isEmbed = p.previousSibling;\n\n            if (typeof $isEmbed === \"undefined\" ||\n                typeof $isEmbed.classList === \"undefined\" ||\n                !$isEmbed.classList.contains(self.opts.cssEmbeds)) {\n                return;\n            }\n\n            e.preventDefault();\n            e.stopPropagation();\n\n            var newP = self.document.createElement(\"p\");\n            $isEmbed.parentElement.insertBefore(newP, $isEmbed);\n            $isEmbed.parentElement.removeChild($isEmbed);\n        },\n\n        \"embedSerialize\": function() {\n            var self = this,\n                data = self._originalSerializerPreEmbeds(),\n                doc = self.options.ownerDocument,\n                embedExtension = self.getExtensionByName(\"embedButton\");\n\n            for (var key in data) {\n                // skip loop if the property is from prototype\n                if (!data.hasOwnProperty(key)) continue;\n\n                var obj = data[key];\n\n                var $data = doc.createElement(\"div\");\n                $data.innerHTML = obj.value;\n\n                var $embeds = $data.querySelectorAll(\".\" + embedExtension.opts.cssEmbeds);\n\n                if (typeof $embeds !== \"undefined\" && $embeds !== null && $embeds.length > 0) {\n                    for (var i = 0;  i < $embeds.length; i++) {\n                        var $embed = $embeds[i];\n                        var responseData = dataset($embed, \"originalResponse\");\n                        if (responseData && null !== responseData) {\n                            var originalData = JSON.parse(responseData);\n                            $embed.innerHTML = originalData.html;\n                            var simpleData = {\n                                \"html\": originalData.html,\n                                \"url\": originalData.url\n                            };\n                            dataset($embed).set(\"originalResponse\", JSON.stringify(simpleData));\n                        }\n                        else { //Back compatibility\n                            var $overlay = $embed.querySelector(\".\" + embedExtension.opts.cssEmbedOverlay);\n                            if ($overlay !== null) {\n                                $overlay.parentElement.removeChild($overlay);\n                            }\n                        }\n                        $embed.removeAttribute(\"contenteditable\");\n                        $embed.classList.remove(embedExtension.opts.cssSelected);\n                    }\n                }\n                data[key].value = $data.innerHTML;\n            }\n\n            return data;\n        },\n\n        \"getHtml\": function($elem) {\n            var $wrap = this.document.createElement(\"div\");\n            $wrap.appendChild($elem.cloneNode(true));\n            return $wrap.innerHTML;\n        },\n\n        \"injectScript\": function(url) {\n            var script = this.document.createElement(\"script\");\n            script.type = \"text/javascript\";\n            script.async = true;\n            script.onLoad = function() {\n            };\n            script.src = this.document.location.protocol + url;\n            this.document.getElementsByTagName(\"head\")[0].appendChild(script);\n        }\n\n    };\n\n    window.EmbedButtonExtension = MediumEditor.extensions.button.extend(embedButton);\n}(window, document, MediumEditor));\n\n"]}